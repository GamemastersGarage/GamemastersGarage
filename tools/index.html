<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sentence-Based Generators</title>
  <link href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'League Spartan', sans-serif;
      background-color: #f8f1e7;
      color: #1a1a1a;
      margin: 20px;
    }

    .generator-block {
      margin-bottom: 40px;
      padding-bottom: 20px;
      border-bottom: 1px solid #ccc;
    }
.sentence {
  font-size: 1.2em;
  line-height: 1.8em;
  white-space: normal;
  overflow: visible;
}


.reroll-word {
  display: inline;
  padding: 0 4px;
  background-color: #ddd;
  border: 1px solid #aaa;
  border-radius: 3px;
  cursor: pointer;
  white-space: normal;
  overflow: visible;
  text-overflow: unset;
  font-weight: normal;
}



    .reroll-all {
      margin-top: 10px;
      font-family: 'League Spartan', sans-serif;
      padding: 6px 12px;
      cursor: pointer;
    }

    a {
      color: #1a1a1a;
      text-decoration: underline;
    }

    a:hover {
      text-decoration: none;
    }
  </style>
</head>
<body>
  <h1>Random Sentence Generators</h1>
  <div id="generators"></div>

  <script>
    const configs = [
      {
        id: "npc",
        title: "NPC Generator",
        description: "This is the NPC generator from *Quick NPCs Vol. 1*, available here:",
        csv: "npc.csv",
        links: {
          etsy: "https://www.etsy.com/yourbook",
          dtrpg: "https://www.drivethrurpg.com/yourbook",
          itch: "https://yourname.itch.io/yourbook"
        },
        template: (words, ids) =>
          `<span class="reroll-word" id="${ids[0]}">${words[0]}</span> has <span class="reroll-word" id="${ids[1]}">${words[1]}</span> hair and <span class="reroll-word" id="${ids[2]}">${words[2]}</span> skin.`
      },
      {
        id: "haunted",
        title: "Haunted House Generator",
        description: "This is the Haunted House generator from *Handbook of Hauntings*, available here:",
        csv: "haunted.csv",
        links: {
          etsy: "https://www.etsy.com/hauntbook",
          dtrpg: "https://www.drivethrurpg.com/hauntbook",
          itch: "https://yourname.itch.io/hauntbook"
        },
        template: (words, ids) =>
          `The <span class="reroll-word" id="${ids[0]}">${words[0]}</span> house has a <span class="reroll-word" id="${ids[1]}">${words[1]}</span> aura and <span class="reroll-word" id="${ids[2]}">${words[2]}</span> doors.`
      }
      // Add more configs as needed
    ];

    function getRandom(arr) {
      if (!arr || arr.length === 0) return '[...]';
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function createGenerator(config) {
      fetch(config.csv)
        .then(res => res.text())
        .then(text => {
          const lines = text.trim().split('\n');
          const headers = lines[0].split(',').map(h => h.trim());
          const records = lines.slice(1).map(line => line.split(',').map(e => e.trim()));

          const data = {};
          headers.forEach((header, i) => {
            data[header] = [];
            records.forEach(row => {
              if (row[i] && row[i].trim() !== '') {
                data[header].push(row[i].trim());
              }
            });
          });

          // Build container
          const container = document.createElement('div');
          container.className = 'generator-block';

          // Title
          const title = document.createElement('h2');
          title.textContent = config.title;
          container.appendChild(title);

          // Description
          const desc = document.createElement('p');
          desc.innerHTML = `${config.description} 
            <a href="${config.links.etsy}" target="_blank">Etsy</a>, 
            <a href="${config.links.dtrpg}" target="_blank">DriveThruRPG</a>, 
            <a href="${config.links.itch}" target="_blank">Itch.io</a>`;
          container.appendChild(desc);

          // Sentence output
          const sentenceWrapper = document.createElement('p');
          sentenceWrapper.className = 'sentence';
          sentenceWrapper.id = `sentence-${config.id}`;
          container.appendChild(sentenceWrapper);

          // Reroll All button
          const rerollAllBtn = document.createElement('button');
          rerollAllBtn.className = 'reroll-all';
          rerollAllBtn.textContent = 'Reroll All';
          rerollAllBtn.onclick = () => rerollAll(config.id, data, headers, config.template);
          container.appendChild(rerollAllBtn);

          // Add to page
          document.getElementById('generators').appendChild(container);

          // Initial render
          rerollAll(config.id, data, headers, config.template);
        });
    }

    function rerollAll(genId, data, headers, templateFunc) {
      const ids = headers.map((h, i) => `${genId}-${i}`);
      const words = headers.map(h => getRandom(data[h]));
      const sentenceHTML = templateFunc(words, ids);
      const sentenceElem = document.getElementById(`sentence-${genId}`);
      sentenceElem.innerHTML = sentenceHTML;

      // Add click handlers
      headers.forEach((header, i) => {
        const btn = document.getElementById(`${genId}-${i}`);
        btn.onclick = () => {
          const newVal = getRandom(data[header]);
          btn.textContent = newVal;
        };
      });
    }

    configs.forEach(cfg => createGenerator(cfg));
  </script>
</body>
</html>
