<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Multi Generator</title>
    <link href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'League Spartan', sans-serif;
            background-color: #f8f1e7;
            color: #1a1a1a;
            margin: 20px;
        }
        .generator-block {
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid #ccc;
        }
        .section {
            margin: 10px 0;
        }
        button {
            margin-left: 10px;
            font-family: 'League Spartan', sans-serif;
            padding: 5px 10px;
            cursor: pointer;
        }
        .output {
            display: inline-block;
            width: 150px;
            font-weight: bold;
        }
        a {
            color: #1a1a1a;
            text-decoration: underline;
        }
        a:hover {
            text-decoration: none;
        }
    </style>
</head>
<body>
    <h1>Random Table Generators</h1>

    <div id="generators"></div>

    <script>
        const configs = [
            {
                title: "NPC Generator",
                description: "This is the NPC generator from *Quick NPCs Vol. 1*, available here:",
                csv: "npc.csv",
                links: {
                    etsy: "https://www.etsy.com/yourbook",
                    dtrpg: "https://www.drivethrurpg.com/yourbook",
                    itch: "https://yourname.itch.io/yourbook"
                }
            },
            {
                title: "Chase Generator",
                description: "This is the Chase generator from *Tables of Tension*, available here:",
                csv: "chase.csv",
                links: {
                    etsy: "https://www.etsy.com/chasebook",
                    dtrpg: "https://www.drivethrurpg.com/chasebook",
                    itch: "https://yourname.itch.io/chasebook"
                }
            },
            {
                title: "Haunted House Generator",
                description: "This is the Haunted House generator from *Handbook of Hauntings*, available here:",
                csv: "haunted.csv",
                links: {
                    etsy: "https://www.etsy.com/hauntbook",
                    dtrpg: "https://www.drivethrurpg.com/hauntbook",
                    itch: "https://yourname.itch.io/hauntbook"
                }
            }
        ];

        function getRandomValue(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        function createGenerator(config, containerId) {
            fetch(config.csv)
                .then(res => res.text())
                .then(text => {
                    const lines = text.trim().split('\n');
                    const headers = lines[0].split(',');
                    const records = lines.slice(1).map(row => row.split(','));
                    const data = {};

                    headers.forEach((header, i) => {
                        data[header] = records.map(row => row[i]);
                    });

                    const wrapper = document.createElement('div');
                    wrapper.className = 'generator-block';

                    const title = document.createElement('h2');
                    title.textContent = config.title;
                    wrapper.appendChild(title);

                    const desc = document.createElement('p');
                    desc.innerHTML = `${config.description} 
                        <a href="${config.links.etsy}" target="_blank">Etsy</a>, 
                        <a href="${config.links.dtrpg}" target="_blank">DriveThruRPG</a>, 
                        <a href="${config.links.itch}" target="_blank">Itch.io</a>`;
                    wrapper.appendChild(desc);

                    const genDiv = document.createElement('div');
                    headers.forEach(header => {
                        const div = document.createElement('div');
                        div.className = 'section';

                        const label = document.createElement('span');
                        label.textContent = `${header}: `;
                        div.appendChild(label);

                        const output = document.createElement('span');
                        output.className = 'output';
                        output.id = `${containerId}-${header}`;
                        div.appendChild(output);

                        const button = document.createElement('button');
                        button.textContent = 'Reroll';
                        button.onclick = () => {
                            const val = getRandomValue(data[header]);
                            output.textContent = val;
                        };
                        div.appendChild(button);

                        genDiv.appendChild(div);
                    });

                    const rerollAllBtn = document.createElement('button');
                    rerollAllBtn.textContent = 'Reroll All';
                    rerollAllBtn.onclick = () => {
                        headers.forEach(header => {
                            const val = getRandomValue(data[header]);
                            document.getElementById(`${containerId}-${header}`).textContent = val;
                        });
                    };
                    genDiv.appendChild(rerollAllBtn);

                    wrapper.appendChild(genDiv);
                    document.getElementById('generators').appendChild(wrapper);

                    // Initial roll
                    rerollAllBtn.click();
                });
        }

        configs.forEach((config, index) => {
            const id = `gen${index}`;
            createGenerator(config, id);
        });
    </script>
</body>
</html>
